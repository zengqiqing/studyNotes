## proxy & Reflect

### proxy

- proxyä¸Reflectæ˜¯es6ä¸ºäº†æ“ä½œå¯¹è±¡å¼•å…¥çš„api

- proxyå¯ä»¥å¯¹ç›®æ ‡å¯¹è±¡çš„è¯»å–ï¼Œå‡½æ•°è°ƒç”¨ç­‰æ“ä½œè¿›è¡Œæ‹¦æˆªï¼Œç„¶åè¿›è¡Œæ“ä½œå¤„ç†ã€‚å®ƒä¸ç›´æ¥æ“ä½œå¯¹è±¡ï¼Œè€Œæ˜¯åƒä»£ç†æ¨¡å¼ï¼Œé€šè¿‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œåœ¨è¿›è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥æ·»åŠ ä¸€äº›éœ€è¦çš„é¢å¤–æ“ä½œã€‚

- Reflectå¯ä»¥ç”¨äºè·å–ç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºï¼Œä»–ä¸Object.definePropertyç±»ä¼¼ï¼Œä½†æ›´æ˜“è¯»ï¼Œä»–çš„æ–¹æ³•ä¸proxyæ˜¯å¯¹åº”çš„ã€‚

- åŸºæœ¬ä½¿ç”¨ï¼š

  ```javascript
  let pro = new Proxy(target,handler);
  
  //å‚æ•°è¯´æ˜ï¼š
  1.new Proxyè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªproxyå®ä¾‹
  2.targetå‚æ•°è¡¨ç¤ºæ‰€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡
  3.handlerå‚æ•°ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼Œç”¨æ¥æŒ‡å®šæ‹¦æˆªè¡Œä¸ºçš„ã€‚
  ```

- æ¡ˆä¾‹å®æˆ˜

  - å½“handeræ‹¦æˆªå¯¹è±¡ä¸ºç©ºå¯¹è±¡æ—¶ï¼Œåˆ™æ„ä¸ºæœªè®¾å®šæ‹¦æˆªæ–¹æ³•ã€‚æ”¹æƒ…å†µä¸‹heroProxyæŒ‡å‘åŸå¯¹è±¡targetï¼Œè®¿é—®heroProxyç­‰åŒäºè®¿é—®åŸå¯¹è±¡

  ```javascript
  var hero = {
      name:'èµµäº‘',
      age:23
  }
  
  let handler = {}
  
  let heroProxy = new Proxy(hero,handler)
  console.log(heroProxy) // ProxyÂ {name: "èµµäº‘", age: 23}
  heroProxy.age = 22 
  console.log(heroProxy)//ProxyÂ {name: "èµµäº‘", age: 23}
  heroProxy.age = 22 
  console.log(hero) // {name: "èµµäº‘", age: 22}
  ```

  - åˆ›å»ºæ‹¦æˆªå¯¹è±¡

    ```javascript
    var hero = {
        name:'æç™½',
        age :24
    }
    
    var handler = {
        get:(hero,name)=>{
            console.log(hero,'--11--',name)
            return `è¯—ä»™æ˜¯${hero.name}`
        },
        set:(hero,name,value)=>{
    console.log(hero,'--22--',name,'--22--',value)
            hero[name] = value
            return true
        }
    }
    
    var heroProxy = new Proxy(hero,handler)
    heroProxy.name = 'æœç”«'
    console.log(heroProxy.name)
    console.log(heroProxy)
    
    //æ‰“å°1ï¼š{name: "æç™½", age: 24} "--22--" "name" "--22--" "æœç”«"
    
    //æ‰“å°2ï¼š{name: "æœç”«", age: 24} "--11--" "name"
    
    //æ‰“å°3ï¼šè¯—ä»™æ˜¯æœç”«
    
    //æ‰“å°4ï¼š{name: "æœç”«", age: 24}
    
    //ä¸€å¼€å§‹æœ‰ç‚¹æ‡µï¼Œä¸ºå•¥æ‰“å°heroProxy.nameå‡ºæ¥æ˜¯æ‰“å°3çš„ç»“æœï¼Œè€Œä¸æ˜¯å°±ä¸€ä¸ªæœç”«å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘åœ¨æ‹¦æˆªå™¨é‡Œé¢getæ–¹æ³•é‡Œé¢returnçš„ä¸œè¥¿ã€‚ä½†ä¸è¦è¯¯ä¼šï¼Œè¿™ä¸ªå¹¶ä¸ä¼šä¿®æ”¹heroå¯¹è±¡ï¼Œèƒ½ä¿®æ”¹heroå¯¹è±¡çš„å°±åªæœ‰æ‹¦æˆªå™¨é‡Œé¢çš„setæ–¹æ³•ã€‚
    ```

    

  - proxyè§£å†³æ•°æ®ç»‘å®šé—®é¢˜

    ```javascript
    var hero = {
        name:'æç™½',
        hp:100,
        sp:200,
        skill:['é©¬','é•¿æª']
    }
    
    var handler = {
        /**
            * target :ç›®æ ‡æºå¯¹è±¡
            * propertyï¼šè¢«ä¿®æ”¹çš„å±æ€§å
            * valueï¼šä¿®æ”¹åçš„å€¼
        **/
        set(target,property,value){
            target[property] = value;
            return true
        }
    }
    
    var heroProxy = new Proxy(hero.skill,handler)
    
    heroProxy.push('åˆ€å­')
    console.log(hero)
    // hp: 100 ,name: "æç™½", skill: (3) ["é©¬", "é•¿æª", "åˆ€å­"], sp: 200
    ```

  - proxyå’Œwebçš„æœåŠ¡çš„å®¢æˆ·ç«¯

    

### Reflect

- åªè¦proxyå¯¹è±¡å…·æœ‰çš„ä»£ç†æ–¹æ³•ï¼ŒReflectå¯¹è±¡å…¨éƒ¨éƒ½å…·æœ‰ï¼Œä»¥é™æ€æ–¹æ³•çš„å½¢å¼å­˜åœ¨ã€‚æ— è®ºproxyæ€ä¹ˆä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œæ€»æ˜¯å¯ä»¥é€šè¿‡Reflectå¯¹åº”çš„æ–¹æ³•è·å–é»˜è®¤è¡Œä¸ºã€‚

- `Object.defineProperty(obj, name, desc)`åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€Œ`Reflect.defineProperty(obj, name, desc)`åˆ™ä¼šè¿”å›`false`ã€‚å¹¶ä¸”Object.definePropertyçš„è¿”å›å€¼æ˜¯è®¾ç½®çš„å¯¹è±¡ï¼›è€ŒReflect.definePropertyçš„è¿”å›å€¼æ˜¯booleanï¼Œè¡¨ç¤ºè®¾ç½®å±æ€§æ˜¯å¦æˆåŠŸ

  ```javascript
  function testDP(){
      let tempObj1 = {}
      let newp1 = Object.defineProperty(tempObj1,'name',{
          value:'coco',
          enumerable:true
      })
      let tempObj2 = {}
      let newp2 = Reflect.defineProperty(tempObj2,'name',{
          value:'kevin',
          enumerable:true,
          'configurable':true
      }) 
      console.log(tempObj1,'1111')
      console.log(tempObj2,'2222')
      console.log(newp1,'xx11111')
      console.log(newp2,'xx22222')
      console.log(tempObj1 === newp1,'=====11111')
      console.log(tempObj2 === newp2,'====22222')
  }
  
  testDP()
  
  // {name: "coco"} "1111"
   // {name: "kevin"} "2222"
  //  {name: "coco"} "xx11111"
  //  true "xx22222"
  //  true "=====11111"
  //  false "====22222"
  ```

  

- è®©`Object`æ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸ºã€‚æŸäº›`Object`æ“ä½œæ˜¯å‘½ä»¤å¼ï¼Œæ¯”å¦‚`name in obj`å’Œ`delete obj[name]`ï¼Œè€Œ`Reflect.has(obj, name)`å’Œ`Reflect.deleteProperty(obj, name)`è®©å®ƒä»¬å˜æˆäº†å‡½æ•°è¡Œä¸ºã€‚

  ```javascript
  let hero = {
    name: 'èµµäº‘',
    hp: 100,
    sp: 100,
    equipment: ['é©¬', 'é•¿æª']
  }
  
  //Objectå¯¹è±¡æ–¹æ³•
  console.log('name' in hero);
  // --> true
  
  //Reflectå¯¹è±¡æ–¹æ³•
  console.log(Reflect.has(hero,'name'));
  // --> true
  ```

- Reflect.deleteProperty(object,name) è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦åˆ é™¤æˆåŠŸ

  ```javascript
  var obj = {id:11,name:'coco'}
  Reflect.deleteProperty(object,name) //true
  console.log(obj) //{id:11}
  ```

- ğŸŒº`Reflect.defineProperty`æ–¹æ³•åŸºæœ¬ç­‰åŒäº`Object.defineProperty`ï¼Œç”¨æ¥ä¸ºå¯¹è±¡å®šä¹‰å±æ€§ã€‚æœªæ¥ï¼Œåè€…ä¼šè¢«é€æ¸åºŸé™¤ï¼Œè¯·ä»ç°åœ¨å¼€å§‹å°±ä½¿ç”¨`Reflect.defineProperty`ä»£æ›¿å®ƒã€‚

### ä½¿ç”¨proxyå®ç°è§‚å¯Ÿè€…æ¨¡å¼

```javascript
var queuedObservers = new Set();
var observe = fn => queuedObservers.add(fn);
var observable = obj => new Proxy(obj,{set})

function set(target,key,value,receiver){
    var result = Reflect.set(target,key,value,receiver);
    queuedObservers.forEach(v=>v())
    return result;
}

var personObj = observable({
    name:'coco',
    age:11
})
function print (){
    console.log(`${personObj.name}-${personObj.age}`)
}


observe(print)
personObj.age = 11
//ç›‘å¬personObjï¼Œå½“æ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œprint
```



