å‰è¨€ï¼šå†™äº†å‡ é“é¢˜ç›®ï¼Œå¾ˆç²—ç•¥åœ°å†™ä¸€ä¸‹å…¨å±€ï¼Œpromiseï¼Œpromise çš„ thenï¼ŒsetTimeoutä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚

```javascript
å‚è€ƒä¾‹å­ï¼š
console.log('111')
setTimeout(()=>{
    console.log(222)
},0)

new Promise((resolve)=>{
    console.log(3333)
    resolve()
}).then(()=>{
    console.log(444)
}).then(res=>{
    console.log(555)
})
console.log(666)

åˆ‡è®°jsè„šæœ¬ä¸­æ‰§è¡Œé¡ºåºæ˜¯ç”±ä¸Šå¾€ä¸‹çš„ï¼Œ
1.å…ˆæ‰§è¡Œé¡¶éƒ¨çš„å…¨å±€çš„ consoleã€‚
2.ä¹‹åå¦‚æœç¢°åˆ° setTimeout æˆ– promiseæ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ promiseå†…éƒ¨
3.ç»§ç»­å¾€ä¸‹èµ°ï¼Œä¼šæ‰§è¡Œpromiseåº•ä¸‹çš„å…¨å±€consoleã€‚
4.ä¹‹åå›å¤´æ‰§è¡Œpromise çš„ thené‡Œé¢çš„ console
5.æœ€åé¢æ‰æ˜¯æ‰§è¡Œ setTimeoutï¼Œä¸ç®¡ setTimeout çš„ delay æ˜¯å¤šå°‘ï¼Œå³ä½¿æ˜¯ 0ï¼Œä»–ä¹Ÿæ˜¯æœ€åæ‰§è¡Œã€‚
æ€»ç»“ï¼šå…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œåæ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œæœ€åæ‰æ‰§è¡Œ setTimeoutï¼ŒsetInterval

```

#### åŠ æ·±è®¤è¯†take2

```javascript
var async1 = ()=>{
    return {id:1,name:'coco'}
}
var func = async ()=>{
    let age = 0
    let sex = ''
    var text = await async1()
    sex = 'lady'
    setTimeout(()=>{
        text.id = 2
				console.log(text.id,'xxxx text.id 1111xxxx')
    },0)
    var p = ()=>new Promise((resolve,reject)=>{
        var num = text.id + 21
        console.log(num,'--- num ----')
				console.log(text.id,'xxxx text.id 22222xxxx')
        resolve(num)
    })
    p().then(res=>{
          age = age + res
    })
    console.log(age,'--- age ----')
		console.log(sex,'--- sex ----')
}

func()
// 22 '--- num ----'
// 1 'xxxx text.id 22222xxxx'
// 0 '--- age ----'
// lady --- sex ---
//2 'xxxx text.id 1111xxxx'


æ˜¯ä¸æ˜¯å¾ˆå¥‡æ€ª text.idåœ¨å®šæ—¶å™¨å†…å‘ç”Ÿäº†æ›´æ”¹ï¼Œä½†æœ€ånumçš„å‡ºæ¥çš„è¿˜æ˜¯ 22ï¼Œè€Œä¸æ˜¯ 23ã€‚è¿™å°±æ˜¯æ— è®ºæ˜¯åœ¨ promise å†…éƒ¨è¿˜æ˜¯åœ¨ promsie çš„å›è°ƒæ‰§è¡Œéƒ½ä¼šæ—©äºå®šæ—¶å™¨ï¼Œæ‰€ä»¥åˆ°æœ€å text.id è™½ç„¶å·²ç»æ”¹å˜äº†ï¼Œä½† num å·²ç»è¢«æ‰§è¡Œå¾—å‡ºå€¼å¹¶æ‰“å°äº†

```

é‚£ä¹ˆæœ‰ä¸Šé¢çš„é¢˜ç›®åšé“ºå«ï¼Œä¸‹é¢æ¥åˆ—ä¸¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯å®è§‚ä»»åŠ¡ä»€ä¹ˆæ˜¯å¾®è§‚ä»»åŠ¡ã€‚

- å®è§‚ä»»åŠ¡ï¼šåœ¨ es3æˆ–æ›´æ—©ç‰ˆæœ¬ä¹‹å‰ï¼Œjs å¹¶æ²¡å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥ä»£ç ç»™åˆ° js å¼•æ“ï¼Œå®ƒæ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œè¿™ä¸ªä»»åŠ¡æ˜¯å®¿ä¸»å‘èµ·çš„ä»»åŠ¡è¢«ç§°ä¹‹ä¸ºå®è§‚ä»»åŠ¡

- å®è§‚ä»»åŠ¡ä¸»è¦åŒ…å«ï¼šsetTimeoutï¼ŒsetInterval,script(æ•´ä½“ä»£ç )ï¼ŒI/O,UIäº¤äº’äº‹ä»¶ï¼ŒsetImmediate(Node.js ç¯å¢ƒ)

- å¾®è§‚ä»»åŠ¡ï¼šåœ¨ es5æˆ–ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œjs å‡ºç°äº† promiseï¼Œè¿™å°±ä¸éœ€è¦æµè§ˆå™¨ä¸»åŠ¨å®‰æ’ï¼Œå¼•æ“å¯ä»¥è‡ªå·±å‘èµ·ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡è¢«ç§°ä¹‹ä¸ºå¾®è§‚ä»»åŠ¡

- å¾®è§‚ä»»åŠ¡ä¸»è¦åŒ…å«ï¼špromise,MutaionObserverã€process.nextTick(Node.js ç¯å¢ƒ)

- ğŸŒºè§„èŒƒï¼šå…ˆæ‰§è¡Œä¸»ä»»åŠ¡ï¼ŒæŠŠå¼‚æ­¥ä»»åŠ¡æ”¾å…¥å¾ªç¯é˜Ÿåˆ—å½“ä¸­ï¼Œç­‰å¾…ä¸»ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå†æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å¼‚æ­¥ä»»åŠ¡ã€‚å¼‚æ­¥ä»»åŠ¡å…ˆæ‰§è¡Œå¾®è§‚ä»»åŠ¡ï¼Œå†æ‰§è¡Œå®è§‚ä»»åŠ¡ã€‚ä¸€ç›´è¿™æ ·å¾ªç¯ï¼Œåå¤æ‰§è¡Œï¼Œå°±æ˜¯äº‹ä»¶å¾ªç¯æœºåˆ¶

  ğŸ‘†æˆ‘çš„è§£è¯»ï¼šå…¨å±€äº‹ä»¶æŒ‰é¡ºåºæ‰§è¡Œï¼Œè¿›å…¥æŸäº‹ä»¶åï¼Œå°†å¼‚æ­¥ä»»åŠ¡(å…¶å®æ˜¯å°† promiseï¼ŒsetTimeout é‚£äº›éƒ½è§†ä¸ºå¼‚æ­¥ä»»åŠ¡)ï¼Œå½“äº‹ä»¶ä¸­promise ä¹‹å‰çš„çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œä¹‹åå†æ‰§è¡Œ promise å†…éƒ¨ï¼Œpromise å®Œæˆåæ‰§è¡Œå…¶å›è°ƒã€‚è‡³æ­¤å¾®è§‚ä»»åŠ¡å®Œæˆï¼Œæ¥ä¸‹æ¥æ£€æŸ¥æ˜¯å¦æœ‰å®è§‚ä»»åŠ¡(setTimeout),å½“å®è§‚ä»»åŠ¡æ‰§è¡Œå®Œåäº‹ä»¶ç®—æ˜¯å®Œæˆæ‰§è¡Œå®Œæ¯•ã€‚

  åˆ‡è®°ï¼šäº‹ä»¶ä¸­çš„æ‰§è¡Œé¡ºåºï¼šå¤–éƒ¨åŒæ­¥ä»£ç (é¡¶å±‚) -> promiseå†…éƒ¨ -> å¤–éƒ¨åŒæ­¥ä»£ç (åº•å±‚) -> promise å›è°ƒ -> settimeout