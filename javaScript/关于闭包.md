## 闭包

闭包

**闭包的用途：**

由于闭包会使得函数中的变量被保存到内存内，内存消耗很大，容易造成内存泄漏，解决方法是：退出函数之前，将不使用的局部变量全部删除

**1.闭包的来源**

![F6CBB8D5-F312-455A-89A6-4FCC16D50C5F](/var/folders/65/71xg97ds6hnc7_6xq9b987rh0000gp/T/com.yinxiang.Mac/WebKitDnD.1ehhg5/F6CBB8D5-F312-455A-89A6-4FCC16D50C5F.png)

因为f2被包括在f1内部，这时的f1内部所有的局部变量对f2来讲都是可见的，但反之，f2的变量f1是不可见的。这跟js的链式作用域有关系， 子函数中可以访问父函数的所有变量。当然也包括全局变量window。反之父函数不能直接访问子函数的变量

![459753C9-376E-469B-8564-EA834A3C9D63](/var/folders/65/71xg97ds6hnc7_6xq9b987rh0000gp/T/com.yinxiang.Mac/WebKitDnD.vZdY0z/459753C9-376E-469B-8564-EA834A3C9D63.png)

既然上面父函数不能直接读取子函数的变量，那么把子函数的变量return出来不就可以读取咯？？？确实也是可以这样做的。但因为f2也是个函数，那么如果你想调用起f2函数，可以学习下面的两种写法

![F52D9FBD-FC32-47C8-B128-EE87BC630910](/var/folders/65/71xg97ds6hnc7_6xq9b987rh0000gp/T/com.yinxiang.Mac/WebKitDnD.2OFCDU/F52D9FBD-FC32-47C8-B128-EE87BC630910.png)

![52146344-FABB-4385-A5E7-C970014ACA20](/var/folders/65/71xg97ds6hnc7_6xq9b987rh0000gp/T/com.yinxiang.Mac/WebKitDnD.q999GL/52146344-FABB-4385-A5E7-C970014ACA20.png)

fn1( )( )的写法是即调用了fn1函数也调用了fn2函数



分析加强例子

![BCCF72AC-F027-490A-8B69-419155BF16FD](/var/folders/65/71xg97ds6hnc7_6xq9b987rh0000gp/T/com.yinxiang.Mac/WebKitDnD.ttsLvR/BCCF72AC-F027-490A-8B69-419155BF16FD.png)

这里面就牵扯到this指向问题。写第一个方法的时候,万万没想到为啥是指向window，因为在闭包中，这里的return出去的函数或者某个值，都是放置到当前js页面的全局中的，那么全局作用域中调用了匿名函数，this指向了window，要想指回去object对象里面的name变量，需要改变他的this指向

![7511EE77-726A-4215-AE25-907E62076D31](/var/folders/65/71xg97ds6hnc7_6xq9b987rh0000gp/T/com.yinxiang.Mac/WebKitDnD.X18enc/7511EE77-726A-4215-AE25-907E62076D31.png)