## 关于html2canvas的踩坑

**html2canvas屏幕截图工具：**

http://html2canvas.hertzen.com/

https://github.com/niklasvh/html2canvas/

编写普通的dom,使用HTML2canvas读取网页上的目标dom节点信息来绘制canvas，摆脱手撸canvas的痛苦

注意：

并非所有的css属性都支持

出现的问题：

1.模糊问题------原因：使用background-image，导致模糊原因出现，使用<img>标签可以解决这个问题

\2. 跨域加载的图片会污染canvas，进而导致canvas无法导出数据----解决方法https://www.jianshu.com/p/22bd5b98e38a

3.页面滚动时，屏幕截图出现白色空白地儿

出现原因：HTML2canvas只截可视区域内的内容

解决方法：

1.把需要截图的dom相关信息放到一个不可滚动区域内（父页面不滚动）

2.使用页面滚动，每当点击生成屏幕截图时，让页面滚动回顶部（ $("body,html").scrollTop(0)）

4.出现白边

原因：画布偏移

解决方案：暂时没用很好的解决方法，只用了一个background：‘none’的属性暂时性解决了

![img](data:image/png;base64,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)

canvas自带的toDataURL,和toBlob方法设置图片为jpeg可以调整图片质量，这次活动中要传base64给原生端，原生端要求传入的base64要控制其大小，过大base64字符过长，原生端获取base64不全时，那么将无法生成图片

https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toDataURL

toDataURL有返回值，toBlob没有返回值， toBlob是异步，toDataURL是同步。但赋值给img来讲toBlob优胜