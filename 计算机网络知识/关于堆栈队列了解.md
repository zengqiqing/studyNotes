## 关于计算机的堆，栈的了解

摘录自阮一峰文章：https://www.ruanyifeng.com/blog/2013/11/stack.html

##### 程序运行时，需要内存空间存放数据，一般来说，系统会划分出两种不同的内存空间，一种叫stack(栈)，一种叫heap（堆）；

##### 一般来说，每个线程分配一个stack，每个进程分配一个heap，也就是说，stack是线程独占的，heap是线程共用的



含义一：数据结构

stack 是数据的存储方式，特点是LIFO（先进后出）

heap的特点是先进先出

```
举个🌰
容器只能容纳3个盒子，现在有a,b,c三个盒子
一开始进入盒子的是a,b,c数据，此时d要进来，那么就把a顶出去，盒子里面装的是b,c,d三个数据
```



与这种结构配套的，是一些特定的方法，主要为下面这些：

```javascript
push：在最顶层加入数据。

pop：返回并移除最顶层的数据。

top：返回最顶层数据的值，但不移除它。

isempty：返回一个布尔值，表示当前stack是否为空栈。
```



含义二：代码的运行方式--- 调用栈,表示函数或子例程像堆积木一样存放，以实现层层调用。

```
//举个🌰
function f1(){
	f2()
}

function f2(){
	f3()
}

function f3(){return 123}
```

以上例子非常简陋，但只是想说明一个东西，就是调用的阿米诺牌（这个名字我瞎叫的，意思就是像多米诺一样，一层推一层的关系）

以上调用的过程总是先完成最上层的调用，然后它的值返回到下层调用，直至完成整个调用栈，返回最后的结果



含义三：存放数据的一种内存区域

堆栈空间的区别主要是：

stack是有结构的，每个区块按照一定次序存放，可以明确知道每个区域的大小

heap是没有结构的，数据可以任意存放，因此stack的寻址速度要快于heap，但寻址到后内存访问速度不会有差异，不过： stack内变量的分配速度会比heap快很多，只需要修改sp寄存器，heap内分配需要调用malloc。 stack的寻址也会比heap快，通过sp/fp寄存器间接寻址



一般来说，每个线程分配一个stack，每个进程分配一个heap，也就是说，stack是线程独占的，heap是线程共用的，（知识补充：线程包含进程，一个运行的任务里面只有一个线程，多个线程）.此外，stack创建的时候，大小是确定的，数据超过这个大小，就发生线程报错，而heap的大小是不确定的，需要的话可以不断增加

🌰🌰🌰🌰🌰🌰

```java
public void method1(){
  {
		int i = 4;
		int y = 2;
		class cls1 = new class1() //对象：
	}
}
/*
上文解释：
	i、y和cls1都存放在stack，因为它们占用内存空间都是确定的，而且本身也属于局部变量。但是，cls1指向的对象实例存放在heap，因为它的大小不确定。作为一条规则可以记住，所有的对象都存放在heap。

当Method1方法运行结束，会发生什么事？

回答是整个stack被清空，i、y和cls1这三个变量消失，因为它们是局部变量，区块一旦运行结束，就没必要再存在了。而heap之中的那个对象实例继续存在，直到系统的垃圾清理机制（garbage collector）将这块内存回收。因此，一般来说，内存泄漏都发生在heap，即某些内存空间不再被使用了，却因为种种原因，没有被系统回收。
*/
```



再举🌰来说明一下：(引用类型数据，存放在堆内存中所带来的影响)

```javascript
var a = 20;
var b = a;
b = 30;
// 这时a的值是多少？ 

// 解答:a的值为20，将a的值赋值给b,则b的值为20，后又改变b的值为30，a的值不受影响，所以a的值仍为20.

// demo02   引用数据类型
var m = { a: 10, b: 20 }；
var n = m;
n.a = 15;
// 这时m.a的值是多少

// 解答：数组是引用数据类型，将数组m赋值给数组n,则实际上n和m在堆内存中访问到的具体对象实际上是同一个，则当 数组n里面的任意值发生改变时，整个数组会改变，由于n和m对应的是同一个数组，则数组m的值发生同样的改变，所以m.a=15.
```



##### 总结：

- 数据存放的规则是：只要是局部的，占用空间确定的数据一般放在stack里面，否则放在heap里面

- 方法运行结束时，占用stack的变量被清空，而线程中的对象实例继续存在，直至系统的垃圾清理机制将内存回收。

- 所有的对象都存放在heap



- 下面就要引申出堆栈空间带来的浅拷贝，深拷贝的问题了

<a name="jump" href="../javaScript/关于深拷贝，浅拷贝的知识.md#test">跳转到深拷贝，浅拷贝的知识》》》》</a>

（按住command 时再点击才能跳转）

